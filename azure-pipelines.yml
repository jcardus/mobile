# Xcode
trigger:
- mobile-dev

pool:
  vmImage: 'macos-latest'

steps:
- task: InstallAppleCertificate@2
  inputs:
    certSecureFile: apple-distribution.p12

- task: InstallAppleProvisioningProfile@1
  inputs:
    provisioningProfileLocation: 'secureFiles' # Options: secureFiles, sourceRepository
    provProfileSecureFile: 'azuredevops.mobileprovision'
    removeProfile: true # Optional

- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      #npm install
      npm run-script deploy:ios:localizalia:beta
      FASTLANE_PASSWORD=$(FASTLANE_PASS)
      FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD=$(FASTLANE_APP_SPECIFIC)
      cd ios/App
      gem install xcodeproj
      ruby addGooglePlist.rb
      echo "add_plugin versioning"
      fastlane add_plugin versioning
      fastlane install_plugins
      fastlane beta
      npm run-script deploy:ios:nogartel:beta

